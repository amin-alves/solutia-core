<script>
const usuarioLogado = JSON.parse(localStorage.getItem("usuarioLogado"));
if (!usuarioLogado) {
  console.warn("Nenhum usuário logado, redirecionando...");
  window.location.href = "index.html";
} else {
  console.log("Usuário logado:", usuarioLogado);
}

// Preencher usuário
document.getElementById("nomeUsuario").innerText = usuarioLogado.email || usuarioLogado.user_metadata?.email || usuarioLogado.usuario;
document.getElementById("perfilUsuario").innerText = usuarioLogado.role || "usuario";

// Multi-tenant
if (window.tenant) {
    document.getElementById("orgao-logo-topbar").src = tenant.logo;
    document.getElementById("orgao-nome-topbar").innerText = tenant.nome;
    document.getElementById("orgao-nome-sidebar").innerText = tenant.nome;
} else {
    console.warn("Tenant não definido!");
}

// Abrir módulo com logs
function abrirModulo(ano, modulo) {
    let link = null;
    if (modulo) link = linksOneDrive[ano]?.[modulo];
    else link = linksOneDrive[ano];

    if(link) {
        console.log("Abrindo link:", link);
        window.open(link, "_blank", "noopener,noreferrer");
    } else {
        console.error("Link do módulo não configurado!", ano, modulo);
        alert("Link do módulo não configurado!");
    }
}
</script>
