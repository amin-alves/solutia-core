<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SOLUTI - Login</title>
<link rel="stylesheet" href="assets/css/style.css">
</head>
<body>

<div class="login-container">
    <img id="orgao-logo" class="logo" alt="Logo do √≥rg√£o">
    <h2 id="orgao-nome"></h2>
    <p>Intranet do √ìrg√£o</p>

    <input type="email" id="usuario" placeholder="Email">

    <div class="password-wrapper">
        <input type="password" id="senha" placeholder="Senha">
        <span class="toggle-password" onclick="toggleSenha()">üëÅ</span>
    </div>

    <button onclick="login()">Entrar</button>

    <div class="footer">
        Powered by Soluti ¬© 2026
    </div>
</div>

<!-- JS -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="js/tenant.js"></script>

<script>
// üî• Supabase
const SUPABASE_URL = "https://fzxhhmklosdowjaztjuy.supabase.co";
const SUPABASE_ANON_KEY = "COLE_AQUI_SUA_CHAVE_COMPLETA"; 
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

// üî• Login
async function login() {
    const email = document.getElementById("usuario").value;
    const senha = document.getElementById("senha").value;

    if (!email || !senha) {
        alert("Preencha todos os campos");
        return;
    }

    console.log("Tentando login com:", email);

    try {
        const { data, error } = await supabase.auth.signInWithPassword({ email, password: senha });

        if (error) {
            console.error("Erro Supabase:", error);
            alert("Erro no login: " + error.message);
            return;
        }

        if (!data.user) {
            console.warn("Usu√°rio retornado √© null ou undefined");
            alert("Falha ao recuperar dados do usu√°rio.");
            return;
        }

        console.log("Login bem-sucedido:", data.user);
        localStorage.setItem("usuarioLogado", JSON.stringify(data.user));
        window.location.href = "dashboard.html";

    } catch (err) {
        console.error("Erro inesperado:", err);
        alert("Erro inesperado: " + err.message);
    }
}

function toggleSenha() {
    const campo = document.getElementById("senha");
    campo.type = campo.type === "password" ? "text" : "password";
}

// üî• Carregar logo e nome do tenant
if(window.tenant) {
    document.getElementById("orgao-logo").src = tenant.logo;
    document.getElementById("orgao-nome").innerText = tenant.nome;
}
</script>

</body>
</html>
